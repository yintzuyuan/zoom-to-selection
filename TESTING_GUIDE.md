# Zoom to Selection 外掛測試指南

## 功能改進說明（v2 - 簡化版）

本次更新大幅簡化了文字選取模式下的寬度計算邏輯：

### 主要改進

1. **簡化寬度計算**：
   - 使用 `layer.width` 總和計算選取範圍寬度
   - 移除複雜的累積計算和比較邏輯
   - 程式碼減少 79 行（從 ~180 行降至 ~100 行）

2. **智慧跨行檢測**：
   - 如果總寬度超過 `editViewWidth`，判定為跨行
   - 檢測換行符號作為強制跨行標記
   - 跨行時自動使用 `editViewWidth` 作為寬度

3. **換行符號處理**：
   - 修正 `_isValidBounds()` 防止 callable 錯誤
   - 自動檢測並跳過換行符號
   - 換行符號數量作為跨行判斷依據

4. **清晰的除錯輸出**：
   - 顯示累積 `layer.width`
   - 顯示 `editViewWidth` 設定值
   - 顯示換行符號數量
   - 明確標示跨行判定原因

## 測試步驟

### 準備工作

1. 在 Glyphs 中開啟測試字型檔案
2. 開啟 Macro Panel（Window > Macro Panel）查看 console 輸出
3. 確保外掛已安裝並啟用

### 測試場景 1：單行文字選取

**目標**：驗證單行選取的基本功能

1. 在 Edit View 中切換到 Text Tool（快捷鍵 `T`）
2. 輸入單行文字，例如：`Hamburgerfonts`
3. 選取部分文字，例如：`burger`
4. 執行外掛縮放功能

**預期結果**：
- Console 顯示「✓ 單行選取」
- 顯示簡化計算和累積計算的對比
- 選取的文字正確縮放到畫面中央
- 如果兩種計算方法差異小於 1.0，使用簡化計算

**檢查項目**：
```
📍 選取圖層數量: 6

📦 處理選取的圖層:
   [0] b: layer.width=500.0
   [1] u: layer.width=500.0
   [2] r: layer.width=400.0
   ...

📏 計算寬度:
   累積 layer.width: 3000.0
   editViewWidth: 4000
   換行符號數量: 0
   判定: ✓ 單行選取
   使用寬度: 3000.0 (累積 layer.width)

📐 計算高度:
   Y 範圍: -150.0 ~ 750.0
   高度: 900.0

✅ 最終邊界:
   origin=(0.0, -150.0)
   size=(3000.0, 900.0)
```

### 測試場景 2：跨兩行文字選取

**目標**：驗證跨行檢測和 editViewWidth 使用

1. 在 Edit View 中輸入較長的文字，使其自動換行
   - 例如：`The quick brown fox jumps over the lazy dog`
2. 選取跨越兩行的文字範圍
   - 例如：從第一行末尾的 `jumps` 到第二行開頭的 `over`
3. 執行外掛縮放功能

**預期結果**：
- Console 顯示「✓ 跨行選取」
- 使用 `Glyphs.editViewWidth` 作為寬度
- 畫面縮放到完整的編輯器行寬
- Y 範圍涵蓋兩行的所有內容

**檢查項目**：
```
📏 計算寬度:
   累積 layer.width: 7000.0
   editViewWidth: 4000
   換行符號數量: 0
   判定: ✓ 跨行選取（寬度超過 editViewWidth）
   使用寬度: 4000 (editViewWidth)

📐 計算高度:
   Y 範圍: -166.0 ~ 725.0
   高度: 891.0

✅ 最終邊界:
   origin=(0.0, -166.0)
   size=(4000, 891.0)
```

### 測試場景 3：多行完整選取

**目標**：驗證多行選取的穩定性

1. 在 Edit View 中輸入多行文字（3-4 行）
2. 選取完整的多行範圍
3. 執行外掛縮放功能

**預期結果**：
- 檢測為跨行選取
- 使用 editViewWidth 作為寬度
- Y 範圍涵蓋所有選取的行

### 測試場景 4：包含換行符號的選取

**目標**：驗證換行符號的處理和強制跨行檢測

1. 在 Edit View 中輸入多行文字（按 Enter 換行）
2. 選取包含換行符號的範圍
   - 例如：選取第一行末尾到第二行開頭（包含換行）
3. 執行外掛縮放功能

**預期結果**：
- Console 顯示「換行符號」被檢測到
- 即使寬度未超過 editViewWidth，仍判定為跨行
- 不會因 callable bounds 崩潰

**檢查項目**：
```
📦 處理選取的圖層:
   [0] a: layer.width=500.0
   [1] b: layer.width=500.0
   [2] newline: 換行符號
   [3] c: layer.width=500.0
   ...

📏 計算寬度:
   累積 layer.width: 2000.0
   editViewWidth: 4000
   換行符號數量: 1
   判定: ✓ 跨行選取（包含換行符號）
   使用寬度: 4000 (editViewWidth)
```

### 測試場景 5：包含空白字符的選取

**目標**：驗證空白字符的處理

1. 選取包含空白（space）的文字範圍
2. 執行外掛縮放功能

**預期結果**：
- 空白字符可能沒有 bounds，但不影響計算
- `layer.width` 仍會被累積
- Console 可能顯示「⚠️ 無效或缺少 bounds」
- 最終縮放結果仍然正確

### 測試場景 6：節點選取模式（回歸測試）

**目標**：確保改動不影響原有的節點選取功能

1. 切換到 Select Tool（快捷鍵 `V`）
2. 選取一些節點或路徑
3. 執行外掛縮放功能

**預期結果**：
- 節點選取模式仍正常工作
- 使用 `_calculateNodeSelectionBounds()` 函數
- 縮放結果正確

## 觀察重點

### 寬度計算驗證

觀察 Console 中「計算寬度」部分的輸出：

1. **累積 layer.width**：
   - 應該等於所有選取圖層的 `layer.width` 總和
   - 包含無效 bounds 的圖層（如空白）

2. **editViewWidth**：
   - 來自 Preferences > Appearance > "Text View Width" 設定
   - 通常在 2000-5000 之間

3. **跨行判定**：
   - 如果累積寬度 > editViewWidth → 跨行（寬度超過）
   - 如果有換行符號 → 跨行（包含換行符號）
   - 否則 → 單行

### 換行符號檢測

如果選取範圍包含換行符號：

1. **Console 顯示**：
   - `[X] <name>: 換行符號`
   - `換行符號數量: N`

2. **強制跨行**：
   - 即使累積寬度 < editViewWidth
   - 仍判定為跨行選取

3. **不會崩潰**：
   - `_isValidBounds()` 正確過濾 callable bounds
   - 不會拋出 AttributeError

## 已知限制

1. **假設 X 起點為 0**：
   - 所有選取範圍假設從 X=0 開始
   - 對於單行選取，這是合理的（相對於選取範圍的局部座標）
   - 對於跨行選取，使用 editViewWidth 覆蓋整行，影響不大

2. **特殊排版**：
   - 垂直排版（vertical text）未經測試
   - 右到左排版（RTL）可能需要額外驗證

3. **editViewWidth 設定依賴**：
   - 跨行檢測依賴使用者在 Preferences > Appearance 中的「Text View Width」設定
   - 如果使用者修改此設定，跨行檢測會相應調整
   - 建議使用預設值進行測試

4. **不同字形寬度**：
   - 程式累積每個圖層的實際 `layer.width`
   - 即使不同字符寬度不同（如 'i' vs 'W'），計算仍然正確
   - 測試時可以混合寬窄字符驗證

## 回報問題

如果發現問題，請記錄：

1. Glyphs 版本號
2. 測試場景描述
3. Console 完整輸出
4. 預期行為 vs 實際行為
5. 截圖（如果可能）

---

**測試完成後，請在 Issue #1 中回報測試結果。**
